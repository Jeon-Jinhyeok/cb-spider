<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CB-Spider CallLog-Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding-top: 50px;
            display: flex;
            gap: 20px;
            padding: 20px;
        }
        .examples-panel {
            width: 300px;
            text-align: left;
            background: #f8f8f8;
            padding: 20px;
            border-radius: 5px;
            border: 1px solid #ddd;
            position: relative;
        }
        .example-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 1px solid #eee;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        .example-item:hover {
            background: #f0f0f0;
        }
        .main-content {
            flex: 1;
            padding: 0 20px;
        }
        #query-input {
            width: 70%;
            padding: 10px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .analyze-btn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #08aab0;
            color: white;
            border: none;
            border-radius: 5px;
        }
        #analysis-result {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
            text-align: left;
            min-height: 400px;
            overflow: auto;
        }
        .progress-indicator {
            display: none;
            width: 100%;
            height: 3px;
            background-color: #f0f0f0;
            position: relative;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-indicator::after {
            content: '';
            position: absolute;
            left: -50%;
            width: 50%;
            height: 100%;
            background-color: #08aab0;
            animation: progress 1s linear infinite;
        }
        @keyframes progress {
            0% { left: -50%; }
            100% { left: 100%; }
        }
        .language-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 3px 8px;
            font-size: 12px;
            background-color: #08aab0;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .examples-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }
        .error-message {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            display: none;
        }
    </style>
    <script>
        const examples = {
            kr: [
                "로그에서 가장 자주 호출되는 API를 분석해줘",
                "CSP별 API 호출 통계를 보여줘",
                "에러가 발생한 API 호출을 분석해줘",
                "응답 시간이 긴 API 호출을 찾아줘",
                "시간대별 API 호출 패턴을 분석해줘",
                "리소스 타입별 API 호출 분포를 보여줘",
                "지역별 API 호출 통계를 보여줘",
                "성공/실패 비율을 분석해줘",
                "특정 리소스의 생성/삭제 패턴을 분석해줘",
                "API 응답시간 추세를 분석해줘"
            ],
            en: [
                "Analyze the most frequently called APIs",
                "Show API call statistics by CSP",
                "Analyze API calls with errors",
                "Find API calls with long response times",
                "Analyze API call patterns by time",
                "Show API call distribution by resource type",
                "Show API call statistics by region",
                "Analyze success/failure ratio",
                "Analyze create/delete patterns for specific resources",
                "Analyze API response time trends"
            ]
        };

        let currentLang = 'kr';

        window.onload = function() {
            setupExamples();
            clearAll();
        }

        function toggleLanguage() {
            currentLang = currentLang === 'kr' ? 'en' : 'kr';
            setupExamples();
            document.getElementById('langToggle').textContent = currentLang === 'kr' ? 'en' : 'kr';
        }

        function setupExamples() {
            const examplesContainer = document.getElementById('examples-list');
            examplesContainer.innerHTML = '';
            
            examples[currentLang].forEach(example => {
                const div = document.createElement('div');
                div.className = 'example-item';
                div.textContent = example;
                div.onclick = () => {
                    document.getElementById('query-input').value = example;
                };
                examplesContainer.appendChild(div);
            });
        }

        function analyzeLogs() {
            const query = document.getElementById('query-input').value;
            if (!query) {
                showError('Please enter an analysis query first.');
                return;
            }

            const resultArea = document.getElementById('analysis-result');
            resultArea.innerHTML = '';
            document.getElementById('progress').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';

            fetch('/spider/adminweb/analyze-logs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Analysis request failed');
                }
                return response.text();
            })
            .then(data => {
                // Show raw HTML in a message box
                // alert('Generated HTML Code:\n\n' + data);
                
                // Display the analysis result
                resultArea.innerHTML = data;
                resultArea.style.display = 'block';
                
                // Execute any scripts in the response
                const scripts = resultArea.getElementsByTagName('script');
                Array.from(scripts).forEach(script => {
                    const newScript = document.createElement('script');
                    Array.from(script.attributes).forEach(attr => {
                        newScript.setAttribute(attr.name, attr.value);
                    });
                    newScript.textContent = script.textContent;
                    script.parentNode.replaceChild(newScript, script);
                });
            })
            .catch(error => {
                showError('Error during analysis: ' + error.message);
                console.error('Analysis error:', error);
            })
            .finally(() => {
                document.getElementById('progress').style.display = 'none';
            });
        }

        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        function clearAll() {
            document.getElementById('query-input').value = '';
            document.getElementById('analysis-result').innerHTML = '';
            document.getElementById('error-message').style.display = 'none';
        }
    </script>
</head>
<body>
    <div class="examples-panel">
        <button id="langToggle" class="language-toggle" onclick="toggleLanguage()">en</button>
        <div class="examples-title">Example Prompts</div>
        <div id="examples-list"></div>
    </div>
    <div class="main-content">
        <h2>CB-Spider CallLog-Analyzer <small style="font-size: 60%; font-weight: normal; font-style: italic;">- powered by LLM</small></h2>
        <p>Enter your command prompt below</p>
        <input type="text" id="query-input" placeholder="What would you like to analyze in the logs?" />
        <button class="analyze-btn" onclick="analyzeLogs()">Analyze Logs</button>
        <div class="progress-indicator" id="progress"></div>
        <div class="error-message" id="error-message"></div>
        <div id="analysis-result"></div>
    </div>
</body>
</html>